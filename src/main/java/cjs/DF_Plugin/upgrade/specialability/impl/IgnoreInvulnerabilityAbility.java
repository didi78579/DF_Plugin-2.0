package cjs.DF_Plugin.upgrade.specialability.impl;

import cjs.DF_Plugin.DF_Main;
import cjs.DF_Plugin.upgrade.specialability.ISpecialAbility;
import org.bukkit.Bukkit;
import org.bukkit.entity.LivingEntity;
import org.bukkit.entity.Player;
import org.bukkit.event.entity.EntityDamageByEntityEvent;
import org.bukkit.inventory.ItemStack;

public class IgnoreInvulnerabilityAbility implements ISpecialAbility {
    @Override
    public String getInternalName() {
        return "ignore_invulnerability";
    }

    @Override
    public String getDisplayName() {
        return "§c무적 관통";
    }

    @Override
    public String getDescription() {
        return "§7공격 시 대상의 무적 시간을 무시합니다.";
    }

    @Override
    public double getCooldown() {
        return 0; // 이 능력은 쿨다운이 없습니다.
    }

    @Override
    public void onDamageByEntity(EntityDamageByEntityEvent event, Player player, ItemStack item) {
        if (event.getEntity() instanceof LivingEntity victim) {
            // 1틱 뒤에 피해 면역 시간을 0으로 설정하여 연속 공격이 가능하게 함
            Bukkit.getScheduler().runTask(DF_Main.getInstance(), () -> {
                // 1틱의 지연 시간 동안 엔티티가 죽거나 사라지는 경우를 대비한 안전 장치입니다.
                if (victim.isValid() && !victim.isDead()) {
                    victim.setNoDamageTicks(0);
                }
            });
        }
    }
}